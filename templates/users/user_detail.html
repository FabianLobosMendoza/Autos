{% extends "base/base.html" %}

{% block title %}Detalle de usuario{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Usuario: {{ user.username }}</h3>
    <div class="btn-group align-items-center">
        <a href="{% url 'edit_user_profile' user.id %}" class="btn btn-sm btn-outline-primary">Editar</a>
        <a href="{% url 'change_user_password' user.id %}" class="btn btn-sm btn-outline-secondary">Cambiar contrase√±a</a>
        <form method="post" action="{% url 'update_user_role' user.id %}" class="d-flex align-items-center">
            {% csrf_token %}
            <select name="role" class="form-select form-select-sm border-primary text-body fw-semibold"
                    onchange="this.form.submit()"
                    style="min-width: 190px; height: 2rem;">
                <option value="vendedor" {% if profile.role == 'vendedor' %}selected{% endif %}>Vendedor</option>
                <option value="negociador" {% if profile.role == 'negociador' %}selected{% endif %}>Negociador oficial de cuenta</option>
                <option value="supervisor" {% if profile.role == 'supervisor' %}selected{% endif %}>Supervisor</option>
                <option value="gestor" {% if profile.role == 'gestor' %}selected{% endif %}>Gestor</option>
                <option value="contable" {% if profile.role == 'contable' %}selected{% endif %}>Contable</option>
                <option value="marqueting" {% if profile.role == 'marqueting' %}selected{% endif %}>Marqueting</option>
                <option value="mantenimiento" {% if profile.role == 'mantenimiento' %}selected{% endif %}>Mantenimiento</option>
                <option value="admin" {% if profile.role == 'admin' %}selected{% endif %}>Administrador</option>
            </select>
        </form>
        <form method="post" action="{% url 'delete_user' user.id %}" class="ms-2 d-flex align-items-center">
            {% csrf_token %}
            <div class="form-check form-switch m-0">
                <input class="form-check-input" type="checkbox" id="toggle-active-{{ user.id }}"
                    name="toggle_active" value="1" {% if user.is_active %}checked{% endif %}
                    onchange="this.form.submit()">
                <label class="form-check-label small" for="toggle-active-{{ user.id }}">
                    {% if user.is_active %}Habilitado{% else %}Deshabilitado{% endif %}
                </label>
            </div>
        </form>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body">
        <h5 class="card-title">Datos basicos</h5>
        <p><strong>Nombre:</strong> {{ user.first_name }} {{ user.last_name }}</p>
        <p><strong>Email:</strong> {{ user.email }}</p>
        <p><strong>Rol:</strong> {{ profile.get_role_display }}</p>
    </div>
</div>

<div class="card">
    <div class="card-body">
        <h5 class="card-title">Perfil</h5>
        <p><strong>Telefono:</strong> {{ profile.phone }}</p>
        <p><strong>Fecha de nacimiento:</strong> {{ profile.birthdate }}</p>
        <p><strong>Direccion:</strong> {{ profile.address }}</p>
        <p><strong>Notas:</strong> {{ profile.notes }}</p>
    </div>
</div>

<div class="mt-3">
    <a href="{% url 'user_list' %}" class="btn btn-link">Volver al listado</a>
</div>
{% endblock %}
